<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <title>覆盖物的添加与移除</title>
  <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css" />
    <script src="https://cache.amap.com/lbs/static/es5.min.js"></script>
    <script type="text/javascript" src="https://cache.amap.com/lbs/static/addToolbar.js"></script>
    <style>
        html,
        body {
          width: 100%;
          height: 100%;
        }
        
        label {
            width: 55px;
            height: 26px;
            line-height: 26px;
            margin-bottom: 0;
        }
        button.btn {
            width: 80px;
        }
        #container {
          width: 100%;
          height: 100%;
          position: relative;
        }
        .container_img{
         position: absolute;
         width: 19px;
         height: 31px;
         top: calc(50% - 31px);
         left: calc(50% - 9px);
        }
    </style>
</head>
<body>
<div id="container"></div>
<div class="input-card" style="width:24rem;">
    <h4>添加、删除覆盖物</h4>
    <div class="input-item">
      <label>Marker：</label>
      <button class="btn" id="add-marker" style="margin-right:1rem;">添加Marker</button>
      <button class="btn" id="remove-marker">删除Marker</button>
    </div>
    <div class="input-item">
      <label>Circle：</label>
      <button class="btn" id="getNewPort" style="margin-right:1rem;">获取当前位置</button>
    </div>
  </div>
<img src="https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png" class="container_img" alt="">
<script src="https://webapi.amap.com/maps?v=2.0&key=8fd7b313b17164d4b68c88390991517c"></script>
<script>
var map = new AMap.Map('container', {
    resizeEnable: true,
    zoom:18,
    center: [125.250987,43.865435]
});

// 构造矢量圆形
var circle = new AMap.Circle({
    center: new AMap.LngLat("125.250987", "43.865435"), // 圆心位置
    radius: 1000,  //半径
    strokeColor: "#F33",  //线颜色
    strokeOpacity: 1,  //线透明度
    strokeWeight: 3,  //线粗细度
    fillColor: "#ee2200",  //填充颜色
    fillOpacity: 0.35, //填充透明度
    showIndoorMap: false //关闭室内地图
});

let timeid = true;
const fun = () => {
  // const {lng,lat} = logMapinfo();
  navigator.geolocation.watchPosition((position) => {
   var marker = new AMap.Marker({
    icon: "https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png",
    position: [position.coords.longitude.toFixed(6),position.coords.latitude.toFixed(6)],
    anchor:'bottom-center'
  });
  map.add(marker);
  if(timeid){
   requestAnimationFrame(fun)
  }
  }, showError, {enableHighAccuracy: true, timeout: 5000, maximumAge: 0})
 
 }
//事件绑定
document.querySelector("#add-marker").onclick = function() {
   timeid = true;
   requestAnimationFrame(fun)
}
document.querySelector("#remove-marker").onclick = function() {
    timeid = false;
}


 function showError(error) {
     // 处理获取位置信息时发生的错误
     switch(error.code) {
         case error.PERMISSION_DENIED:
           console.log('用户拒绝对获取地理位置的请求。');
             break;
         case error.POSITION_UNAVAILABLE:
           console.log('位置信息不可用。');
             break;
         case error.TIMEOUT:
           console.log('请求用户地理位置超时。');
             break;
         case error.UNKNOWN_ERROR:
           console.log('发生未知错误。');
             break;
     }
     requestAnimationFrame(fun)
 }
 document.querySelector("#getNewPort").onclick = () => {
  navigator.geolocation.getCurrentPosition((position)=>{
   alert(position.coords.longitude.toFixed(6) +'++++ '+position.coords.latitude.toFixed(6))
  }, showError);

 }


 //显示地图层级与中心点信息
 function logMapinfo(){
   var zoom = map.getZoom(); //获取当前地图级别
   var center = map.getCenter(); //获取当前地图中心位置
   return {lng:center.lng,lat:center.lat}
 };

</script>
</body>
</html>